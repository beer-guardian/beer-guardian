(function(){function e(a){var e=a.ibu;a.ibu.length>3&&(e=a.ibu.slice(0,-2)),$(".active-beer-modal").attr("id",a.id),$(".active-beer-modal .header .title").html(a.name),$(".active-beer-modal .brewery").html(a.brewery),$(".active-beer-modal .body p").html(a.desc),$(".active-beer-modal .widget.abv .number").html(a.abv),$(".active-beer-modal .widget.ibu .number").html(e),$(".active-beer-modal .widget.score .number").html(a.score),$(".active-beer-modal .image").css("background-image",a.label),$(".modal-cover").fadeIn("fast"),$(".active-beer-modal").addClass("reveal")}function t(){$(".modal-cover").fadeIn("fast"),$(".add-beer-modal").addClass("reveal")}function i(){$(".add-beer-modal ul").empty(),$("#input-beer-search").val(""),$("#input-beer-search").removeClass("disabled"),$(".modal-cover").fadeOut("fast"),$(".modal").removeClass("reveal")}function r(a){$(".add-beer-modal ul").empty();var e="/api/v1/search?q="+a;""!==a&&$.get(e,function(e){$.each(e,function(a,e){e.breweries&&$(".add-beer-modal ul").append('<li data-id="'+e.id+'"><div>'+e.name+'</div><div class="small">'+e.breweries[0].name+"</div></li>")}),$(".add-beer-modal ul").append("<li data-name='"+a+"'><div>'"+a+"'</div><div class='small'>Don't see what you want? Submit your current search term.</div></li>")})}function n(a,e){$.post("/api/v1/request",{beer:e,name:a}).done(function(a){$(".add-beer-modal ul").empty(),$("#input-beer-search").val("Beer requested, thank you."),$("#input-beer-search").addClass("disabled")})}function d(a,e){$.post("/api/v1/vote",{beer:a,vote:e}).done(function(e){s(a)}).catch(function(a){"Unauthorized"==a.responseJSON.message&&(window.location="/register")})}function c(){$(".card .score span").each(function(){var a=parseFloat($(this).text());a<0?$(this).addClass("negative"):$(this).removeClass("negative")})}function s(a){var e="/api/v1/beers/"+a;$.get(e,function(e){$("#"+a+" .score span").html(e.score),$("#"+a).attr("data-score",e.score),$("#"+a+".active-beer-modal .score .number").html(e.score),c()})}function o(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("safari")!=-1)return!(a.indexOf("chrome")>-1)}$(function(){if(setTimeout(function(){$("body").addClass("page-loaded")},2e3),"/"==window.location.pathname){if($("#pass + .close").on("click",function(){$("#pass").val("")}),c(),!o()){$(".js-tilt").tilt({glare:!0,maxGlare:.3,speed:400,scale:1,maxTilt:10,perspective:500})}$("#input-beer-search").keypress(function(a){if(13==a.which)return r($("#input-beer-search").val()),!1}),$(".beer-cards .card-active").click(function(){var a={name:$(this).find(".title").text(),brewery:$(this).find(".meta").text(),desc:$(this).find(".desc").text(),abv:$(this).attr("data-abv"),ibu:$(this).attr("data-ibu"),id:$(this).attr("data-id"),score:$(this).attr("data-score"),label:$(this).css("background-image")};e(a)}),$(".card .vote-up").click(function(a){var e=$(this).parent().parent().attr("data-id");d(e,"UP"),a.stopPropagation()}),$(".card .vote-down").click(function(a){var e=$(this).parent().parent().attr("data-id");d(e,"DOWN"),a.stopPropagation()}),$(".active-beer-modal .vote-up").click(function(){var a=$(".active-beer-modal").attr("id");d(a,"UP")}),$(".active-beer-modal .vote-down").click(function(){var a=$(".active-beer-modal").attr("id");d(a,"DOWN")}),$(".beer-cards .card-add").click(function(){t(),setTimeout(function(){$("#input-beer-search").focus()},100)}),$(".modal-cover").click(function(){i()}),$(".modal-close").click(function(){i()})}else"/admin"==window.location.pathname&&($(".sub-nav-admin li").click(function(){var a=$(this).attr("data-button");$(".tab-content").hide(),$(".tab").removeClass("active"),$("div[data-tab='"+a+"']").show(),$("li[data-button='"+a+"']").addClass("active")}),$.get("/api/v1/beers",function(a){var e=$("#beer-table").DataTable({paging:!1,order:[[0,"desc"]],columnDefs:[{targets:[0,1,2],className:"mdl-data-table__cell--non-numeric"}],language:{searchPlaceholder:"Search",search:"",emptyTable:"No beers in database"},data:a,columns:[{data:"score"},{data:"_id",fnCreatedCell:function(a,e,t,i,r){$(a).html("<a href='/admin/forms/beer/"+e+"'>"+e+"</a>")}},{data:"name"},{data:"brewery"}]});$(".table-1-search").keyup(function(){e.search($(this).val()).draw()})}),$.get("/api/v1/admin/requests",function(e){console.log(e);var t=$("#request-table").DataTable({paging:!1,columnDefs:[{targets:[0,1,2],className:"mdl-data-table__cell--non-numeric"}],language:{searchPlaceholder:"Search",search:"",emptyTable:"No pending requests"},data:e,columns:[{data:"_id"},{data:"name"},{data:"brewerydbId",defaultContent:"custom request"},{data:"_id",fnCreatedCell:function(e,t,i,r,n){$(e).html('<a class="approve-link" href="/admin/forms/request/'+t+'">APPROVE</a><a class="approve-link deny" href="/admin/forms/deny/'+t+'">DENY</a>'),a}}]});$(".table-2-search").keyup(function(){t.search($(this).val()).draw()})}),$.get("/api/v1/admin/users",function(a){var e=$("#user-table").DataTable({paging:!1,columnDefs:[{targets:[0,1,2],className:"mdl-data-table__cell--non-numeric"}],language:{searchPlaceholder:"Search",search:""},data:a,columns:[{data:"_id"},{data:"email"},{data:"admin"}]});$(".table-3-search").keyup(function(){e.search($(this).val()).draw()})}))}),$("body").on("click",".add-beer-modal li",function(){var a=$(this).attr("data-name");void 0==a&&(a=null);var e=$(this).attr("data-id");void 0==e&&(e=null),n(a,e)})})();